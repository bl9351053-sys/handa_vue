{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { reactive, ref, inject, onMounted } from 'vue';\nimport axios from 'axios';\nimport { useRouter, useRoute } from 'vue-router';\nexport default {\n  __name: 'FamilyEdit',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const route = useRoute();\n    const baseUrl = inject('baseUrl', '');\n    const familyId = route.params.id;\n    const form = reactive({\n      family_head_name: '',\n      contact_number: '',\n      address: '',\n      total_members: 1,\n      evacuation_area_id: '',\n      status: 'pending',\n      special_needs: '',\n      members: []\n    });\n    const errors = reactive({});\n    const generalError = ref('');\n    const submitting = ref(false);\n    const loading = ref(true);\n    const evacuationAreas = ref([]);\n    const deletedMemberIds = ref([]);\n    onMounted(async () => {\n      await Promise.all([fetchFamily(), fetchEvacuationAreas()]);\n    });\n    async function fetchFamily() {\n      try {\n        const res = await axios.get(`${baseUrl}/families/${familyId}`);\n        const family = res.data?.data || res.data;\n        Object.assign(form, family);\n      } catch (err) {\n        generalError.value = 'Failed to load family. Please try again.';\n      } finally {\n        loading.value = false;\n      }\n    }\n    async function fetchEvacuationAreas() {\n      try {\n        const res = await axios.get(`${baseUrl}/evacuation-areas`);\n        evacuationAreas.value = res.data?.data || res.data || [];\n      } catch (err) {\n        console.error('Failed to fetch evacuation areas:', err);\n      }\n    }\n    function addMember() {\n      form.members.push({\n        name: '',\n        age: null,\n        gender: ''\n      });\n    }\n    function removeMember(index, memberId) {\n      if (memberId) deletedMemberIds.value.push(memberId);\n      form.members.splice(index, 1);\n    }\n    async function submit() {\n      submitting.value = true;\n      generalError.value = '';\n      Object.keys(errors).forEach(k => delete errors[k]);\n      try {\n        const payload = {\n          family_head_name: form.family_head_name,\n          contact_number: form.contact_number || null,\n          address: form.address,\n          total_members: form.total_members,\n          evacuation_area_id: form.evacuation_area_id || null,\n          status: form.status,\n          special_needs: form.special_needs || null,\n          members: form.members,\n          deleted_ids: deletedMemberIds.value.join(',')\n        };\n        await axios.put(`${baseUrl}/families/${familyId}`, payload);\n        router.push('/families');\n      } catch (err) {\n        if (err.response?.status === 422) Object.assign(errors, err.response.data.errors || {});else generalError.value = err.response?.data?.message || 'Failed to update family. Please try again.';\n      } finally {\n        submitting.value = false;\n      }\n    }\n    const __returned__ = {\n      router,\n      route,\n      baseUrl,\n      familyId,\n      form,\n      errors,\n      generalError,\n      submitting,\n      loading,\n      evacuationAreas,\n      deletedMemberIds,\n      fetchFamily,\n      fetchEvacuationAreas,\n      addMember,\n      removeMember,\n      submit,\n      reactive,\n      ref,\n      inject,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get useRoute() {\n        return useRoute;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["reactive","ref","inject","onMounted","axios","useRouter","useRoute","router","route","baseUrl","familyId","params","id","form","family_head_name","contact_number","address","total_members","evacuation_area_id","status","special_needs","members","errors","generalError","submitting","loading","evacuationAreas","deletedMemberIds","Promise","all","fetchFamily","fetchEvacuationAreas","res","get","family","data","Object","assign","err","value","console","error","addMember","push","name","age","gender","removeMember","index","memberId","splice","submit","keys","forEach","k","payload","deleted_ids","join","put","response","message"],"sources":["C:/VUEprojects/crud-app/src/pages/FamilyEdit.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <div>\r\n        <h1>Edit Family</h1>\r\n        <p>Update family information</p>\r\n      </div>\r\n      <router-link to=\"/families\" class=\"back-link\">\r\n        <span class=\"arrow\">&#8592;</span> Back to Families\r\n      </router-link>\r\n    </div>\r\n\r\n```\r\n<div v-if=\"loading\" class=\"loading-card\">\r\n  <div class=\"spinner\"></div>\r\n  <span>Loading family...</span>\r\n    </div>\r\n    <div v-else class=\"card\">\r\n  <!-- Error Messages -->\r\n  <div v-if=\"generalError\" class=\"error-card mb-6\">\r\n    <p>{{ generalError }}</p>\r\n  </div>\r\n\r\n  <form @submit.prevent=\"submit\" class=\"space-y-6\">\r\n    <!-- Row 1: Family Head Name & Contact -->\r\n    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n      <div>\r\n        <label class=\"label\">Family Head Name <span class=\"text-red-500\">*</span></label>\r\n        <input v-model=\"form.family_head_name\" type=\"text\" required class=\"input-field\" />\r\n        <p v-if=\"errors.family_head_name\" class=\"error-text\">{{ errors.family_head_name }}</p>\r\n      </div>\r\n      <div>\r\n        <label class=\"label\">Contact Number</label>\r\n        <input v-model=\"form.contact_number\" type=\"text\" class=\"input-field\" />\r\n        <p v-if=\"errors.contact_number\" class=\"error-text\">{{ errors.contact_number }}</p>\r\n      </div>\r\n    </div>\r\n    <div>\r\n      <label class=\"label\">Address <span class=\"text-red-500\">*</span></label>\r\n      <textarea v-model=\"form.address\" rows=\"3\" required class=\"input-field\"></textarea>\r\n      <p v-if=\"errors.address\" class=\"error-text\">{{ errors.address }}</p>\r\n    </div>\r\n    <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n      <div>\r\n        <label class=\"label\">Total Members <span class=\"text-red-500\">*</span></label>\r\n        <input v-model.number=\"form.total_members\" type=\"number\" required min=\"1\" class=\"input-field\" />\r\n        <p v-if=\"errors.total_members\" class=\"error-text\">{{ errors.total_members }}</p>\r\n      </div>\r\n      <div>\r\n        <label class=\"label\">Evacuation Area</label>\r\n        <select v-model=\"form.evacuation_area_id\" class=\"input-field\">\r\n          <option value=\"\">Not assigned</option>\r\n          <option v-for=\"area in evacuationAreas\" :key=\"area.id\" :value=\"area.id\">{{ area.name }}</option>\r\n        </select>\r\n        <p v-if=\"errors.evacuation_area_id\" class=\"error-text\">{{ errors.evacuation_area_id }}</p>\r\n      </div>\r\n      <div>\r\n        <label class=\"label\">Status <span class=\"text-red-500\">*</span></label>\r\n        <select v-model=\"form.status\" required class=\"input-field\">\r\n          <option value=\"pending\">Pending</option>\r\n          <option value=\"evacuated\">Evacuated</option>\r\n          <option value=\"returned\">Returned</option>\r\n        </select>\r\n        <p v-if=\"errors.status\" class=\"error-text\">{{ errors.status }}</p>\r\n      </div>\r\n    </div>\r\n    <div>\r\n      <label class=\"label\">Special Needs</label>\r\n      <textarea v-model=\"form.special_needs\" rows=\"2\" class=\"input-field\"></textarea>\r\n      <p v-if=\"errors.special_needs\" class=\"error-text\">{{ errors.special_needs }}</p>\r\n    </div>\r\n    <div class=\"family-members\">\r\n      <h3>Family Members</h3>\r\n      <div id=\"members-wrapper\" class=\"space-y-3 mb-4\">\r\n        <div v-for=\"(member, index) in form.members\" :key=\"index\" class=\"member-card\">\r\n          <input v-model=\"member.name\" type=\"text\" placeholder=\"Name\" required class=\"member-input\" />\r\n          <input v-model.number=\"member.age\" type=\"number\" placeholder=\"Age\" min=\"0\" class=\"member-input\" />\r\n          <select v-model=\"member.gender\" class=\"member-input\">\r\n            <option value=\"\">Gender</option>\r\n            <option value=\"male\">Male</option>\r\n            <option value=\"female\">Female</option>\r\n          </select>\r\n          <button type=\"button\" @click=\"removeMember(index, member.id)\" class=\"remove-btn\">Remove</button>\r\n        </div>\r\n      </div>\r\n      <button type=\"button\" @click=\"addMember\" class=\"add-btn\">+ Add Member</button>\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <router-link to=\"/families\" class=\"cancel-btn\">Cancel</router-link>\r\n      <button type=\"submit\" :disabled=\"submitting\" class=\"submit-btn\">\r\n        <span v-if=\"!submitting\">Update Family</span>\r\n        <span v-else>Updating...</span>\r\n      </button>\r\n    </div>\r\n  </form>\r\n</div>\r\n```\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref, inject, onMounted } from 'vue'\r\nimport axios from 'axios'\r\nimport { useRouter, useRoute } from 'vue-router'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst baseUrl = inject('baseUrl', '')\r\nconst familyId = route.params.id\r\n\r\nconst form = reactive({\r\n  family_head_name: '',\r\n  contact_number: '',\r\n  address: '',\r\n  total_members: 1,\r\n  evacuation_area_id: '',\r\n  status: 'pending',\r\n  special_needs: '',\r\n  members: []\r\n})\r\nconst errors = reactive({})\r\nconst generalError = ref('')\r\nconst submitting = ref(false)\r\nconst loading = ref(true)\r\nconst evacuationAreas = ref([])\r\nconst deletedMemberIds = ref([])\r\n\r\nonMounted(async () => {\r\n  await Promise.all([fetchFamily(), fetchEvacuationAreas()])\r\n})\r\n\r\nasync function fetchFamily() {\r\n  try {\r\n    const res = await axios.get(`${baseUrl}/families/${familyId}`)\r\n    const family = res.data?.data || res.data\r\n    Object.assign(form, family)\r\n  } catch (err) {\r\n    generalError.value = 'Failed to load family. Please try again.'\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nasync function fetchEvacuationAreas() {\r\n  try {\r\n    const res = await axios.get(`${baseUrl}/evacuation-areas`)\r\n    evacuationAreas.value = res.data?.data || res.data || []\r\n  } catch (err) {\r\n    console.error('Failed to fetch evacuation areas:', err)\r\n  }\r\n}\r\n\r\nfunction addMember() {\r\n  form.members.push({ name: '', age: null, gender: '' })\r\n}\r\n\r\nfunction removeMember(index, memberId) {\r\n  if (memberId) deletedMemberIds.value.push(memberId)\r\n  form.members.splice(index, 1)\r\n}\r\n\r\nasync function submit() {\r\n  submitting.value = true\r\n  generalError.value = ''\r\n  Object.keys(errors).forEach(k => delete errors[k])\r\n\r\n  try {\r\n    const payload = {\r\n      family_head_name: form.family_head_name,\r\n      contact_number: form.contact_number || null,\r\n      address: form.address,\r\n      total_members: form.total_members,\r\n      evacuation_area_id: form.evacuation_area_id || null,\r\n      status: form.status,\r\n      special_needs: form.special_needs || null,\r\n      members: form.members,\r\n      deleted_ids: deletedMemberIds.value.join(',')\r\n    }\r\n    await axios.put(`${baseUrl}/families/${familyId}`, payload)\r\n    router.push('/families')\r\n  } catch (err) {\r\n    if (err.response?.status === 422) Object.assign(errors, err.response.data.errors || {})\r\n    else generalError.value = err.response?.data?.message || 'Failed to update family. Please try again.'\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container { max-width: 900px; margin: 0 auto; padding: 20px; }\r\n.header { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; }\r\n.header h1 { font-size:2.5rem; font-weight:bold; background:linear-gradient(90deg,#4f46e5,#06b6d4); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }\r\n.header p { color:#374151; margin-top:4px; }\r\n.back-link { font-weight:500; color:#4f46e5; display:flex; align-items:center; gap:5px; }\r\n.back-link:hover { text-decoration:underline; }\r\n\r\n/* Card */\r\n.card { background:linear-gradient(135deg, #f9f9ff, #ffffff); border-radius:12px; padding:30px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }\r\n.loading-card, .error-card { background:#fff; padding:30px; border-radius:12px; text-align:center; box-shadow:0 4px 15px rgba(0,0,0,0.05); display:flex; flex-direction:column; align-items:center; gap:10px; }\r\n.spinner { border:4px solid #e5e7eb; border-top:4px solid #4f46e5; border-radius:50%; width:36px; height:36px; animation:spin 1s linear infinite; }\r\n@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }\r\n.error-text { color:#b91c1c; font-size:0.875rem; margin-top:4px; }\r\n\r\n/* Form */\r\n.label { display:block; font-size:0.875rem; font-weight:500; color:#374151; margin-bottom:6px; }\r\n.input-field { width:100%; padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; outline:none; transition:0.2s; }\r\n.input-field:focus { border-color:#4f46e5; box-shadow:0 0 0 2px rgba(79,70,229,0.2); }\r\n\r\n/* Family Members */\r\n.family-members h3 { font-weight:600; margin-bottom:8px; color:#111827; }\r\n.member-card { display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:8px; padding:10px; background:#f3f4f6; border-radius:8px; }\r\n.member-input { width:100%; padding:8px; border:1px solid #d1d5db; border-radius:6px; outline:none; transition:0.2s; }\r\n.member-input:focus { border-color:#4f46e5; box-shadow:0 0 0 2px rgba(79,70,229,0.2); }\r\n.remove-btn { background:#dc2626; color:#fff; border:none; border-radius:6px; font-weight:500; cursor:pointer; transition:0.2s; }\r\n.remove-btn:hover { background:#b91c1c; }\r\n.add-btn { background:#16a34a; color:#fff; padding:10px 16px; border-radius:8px; font-weight:500; cursor:pointer; transition:0.2s; }\r\n.add-btn:hover { background:#15803d; }\r\n\r\n/* Actions */\r\n.form-actions { display:flex; justify:end; gap:12px; margin-top:16px; }\r\n.cancel-btn { padding:10px 16px; border:1px solid #d1d5db; border-radius:8px; font-weight:500; color:#374151; text-align:center; }\r\n.cancel-btn:hover { background:#f9fafb; }\r\n.submit-btn { background:#4f46e5; color:#fff; padding:10px 16px; border-radius:8px; font-weight:500; transition:0.2s; }\r\n.submit-btn:hover { background:#4338ca; }\r\n.submit-btn:disabled { opacity:0.6; cursor:not-allowed; }\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}