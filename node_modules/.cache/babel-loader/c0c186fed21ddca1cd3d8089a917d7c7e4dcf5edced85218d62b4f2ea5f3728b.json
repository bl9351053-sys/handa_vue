{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, inject, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nexport default {\n  __name: 'DisasterUpdatesList',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const residentAxios = inject('residentAxios');\n    const updates = ref([]);\n    const loading = ref(false);\n    const error = ref(null);\n    const syncing = ref(false);\n    const pagination = ref(null);\n    const fetchUpdates = async (page = 1) => {\n      loading.value = true;\n      error.value = null;\n      try {\n        console.log('[Disaster] Fetching updates, page:', page);\n        const response = await residentAxios.get('/disaster-updates', {\n          params: {\n            page\n          }\n        });\n        if (response.data && response.data.data) {\n          updates.value = response.data.data;\n          pagination.value = {\n            current_page: response.data.current_page,\n            last_page: response.data.last_page,\n            total: response.data.total\n          };\n          console.log('[Disaster] Updates fetched:', updates.value.length);\n        }\n      } catch (err) {\n        console.error('[Disaster] Fetch error:', err);\n        error.value = 'Failed to load disaster updates. Please try again.';\n      } finally {\n        loading.value = false;\n      }\n    };\n    const syncUpdates = async () => {\n      syncing.value = true;\n      error.value = null;\n      try {\n        console.log('[Disaster] Syncing updates from PAGASA/PhiVolcs/NDRRMC...');\n        const response = await residentAxios.post('/disaster-updates/sync');\n        if (response.data && response.data.success) {\n          alert(`‚úì Successfully synced ${response.data.synced_count} updates from PAGASA, PhiVolcs, and NDRRMC!\\n\\n${response.data.message}`);\n          await fetchUpdates(1);\n        } else {\n          alert('‚úó Error: ' + (response.data?.message || 'Unknown error'));\n        }\n      } catch (err) {\n        console.error('[Disaster] Sync error:', err);\n        error.value = 'Failed to sync updates. Please try again.';\n      } finally {\n        syncing.value = false;\n      }\n    };\n    const goToDetail = id => {\n      console.log('[Disaster] Navigating to detail:', id);\n      router.push({\n        path: `/resident_pages/disaster-updates/${id}`\n      });\n    };\n    const formatDate = dateString => {\n      try {\n        const date = new Date(dateString);\n        return date.toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric',\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n      } catch (e) {\n        return dateString;\n      }\n    };\n    const getTimeAgo = dateString => {\n      try {\n        const date = new Date(dateString);\n        const now = new Date();\n        const seconds = Math.floor((now - date) / 1000);\n        if (seconds < 60) return `${seconds}s ago`;\n        if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n        if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\n        if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;\n        return `${Math.floor(seconds / 604800)}w ago`;\n      } catch (e) {\n        return '';\n      }\n    };\n    onMounted(() => {\n      console.log('[Disaster] Component mounted');\n      fetchUpdates(1);\n    });\n    const __returned__ = {\n      router,\n      residentAxios,\n      updates,\n      loading,\n      error,\n      syncing,\n      pagination,\n      fetchUpdates,\n      syncUpdates,\n      goToDetail,\n      formatDate,\n      getTimeAgo,\n      ref,\n      inject,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","inject","onMounted","useRouter","router","residentAxios","updates","loading","error","syncing","pagination","fetchUpdates","page","value","console","log","response","get","params","data","current_page","last_page","total","length","err","syncUpdates","post","success","alert","synced_count","message","goToDetail","id","push","path","formatDate","dateString","date","Date","toLocaleDateString","year","month","day","hour","minute","e","getTimeAgo","now","seconds","Math","floor"],"sources":["C:/VUEprojects/crud-app/src/pages/resident_pages/DisasterUpdatesList.vue"],"sourcesContent":["<template>\r\n  <div class=\"space-y-6\">\r\n    <!-- Header -->\r\n    <div class=\"flex items-center justify-between\">\r\n      <h1 class=\"text-3xl font-bold text-gray-800\">\r\n        üö® Disaster Updates\r\n      </h1>\r\n      <button\r\n        @click=\"syncUpdates\"\r\n        :disabled=\"syncing\"\r\n        class=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2\"\r\n      >\r\n        <span v-if=\"!syncing\">üîÑ Sync Updates</span>\r\n        <span v-else>‚è≥ Syncing...</span>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Info Box -->\r\n    <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\r\n      <p class=\"text-sm text-yellow-800\">\r\n        <strong>üì° Official Data Sources:</strong> Disaster updates are automatically synced from official Philippine government agencies:\r\n        <strong>PAGASA</strong> (weather, typhoons, floods), <strong>PhiVolcs</strong> (earthquakes, volcanoes, tsunamis), and <strong>NDRRMC</strong> (disaster management).\r\n      </p>\r\n    </div>\r\n\r\n    <!-- Loading State -->\r\n    <div v-if=\"loading\" class=\"text-center py-8\">\r\n      <p class=\"text-gray-600\">Loading disaster updates...</p>\r\n    </div>\r\n\r\n    <!-- Error State -->\r\n    <div v-if=\"error\" class=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n      <p class=\"text-red-800\">{{ error }}</p>\r\n    </div>\r\n\r\n    <!-- Empty State -->\r\n    <div v-if=\"!loading && !error && updates.length === 0\" class=\"text-center py-8\">\r\n      <p class=\"text-gray-600\">No disaster updates available.</p>\r\n    </div>\r\n\r\n    <!-- Updates List -->\r\n    <div v-if=\"!loading && !error && updates.length > 0\" class=\"space-y-4\">\r\n      <div\r\n        v-for=\"update in updates\"\r\n        :key=\"update.id\"\r\n        :class=\"[\r\n          'border rounded-lg p-4 cursor-pointer hover:shadow-lg transition-shadow',\r\n          {\r\n            'bg-red-50 border-red-300': update.severity === 'critical',\r\n            'bg-orange-50 border-orange-300': update.severity === 'high',\r\n            'bg-yellow-50 border-yellow-300': update.severity === 'moderate',\r\n            'bg-blue-50 border-blue-300': update.severity === 'low',\r\n          }\r\n        ]\"\r\n        @click=\"goToDetail(update.id)\"\r\n      >\r\n        <div class=\"flex items-start justify-between gap-4\">\r\n          <div class=\"flex-1\">\r\n            <div class=\"flex items-center gap-3 mb-2\">\r\n              <h3 class=\"text-lg font-semibold text-gray-800\">{{ update.title }}</h3>\r\n              <span\r\n                :class=\"[\r\n                  'px-3 py-1 rounded-full text-xs font-semibold',\r\n                  {\r\n                    'bg-red-600 text-white': update.severity === 'critical',\r\n                    'bg-orange-600 text-white': update.severity === 'high',\r\n                    'bg-yellow-600 text-white': update.severity === 'moderate',\r\n                    'bg-blue-600 text-white': update.severity === 'low',\r\n                  }\r\n                ]\"\r\n              >\r\n                {{ update.severity.charAt(0).toUpperCase() + update.severity.slice(1) }}\r\n              </span>\r\n              <span class=\"px-3 py-1 rounded-full text-xs font-semibold bg-gray-300 text-gray-800\">\r\n                {{ update.disaster_type.charAt(0).toUpperCase() + update.disaster_type.slice(1) }}\r\n              </span>\r\n            </div>\r\n\r\n            <p class=\"text-sm text-gray-600 mb-2\">\r\n              {{ update.source }} ‚Ä¢ {{ formatDate(update.issued_at) }} ({{ getTimeAgo(update.issued_at) }})\r\n            </p>\r\n\r\n            <p class=\"text-gray-700\">{{ update.description }}</p>\r\n          </div>\r\n\r\n          <div class=\"flex-shrink-0\">\r\n            <button\r\n              @click.stop=\"goToDetail(update.id)\"\r\n              class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium\"\r\n            >\r\n              View Details\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Pagination -->\r\n      <div v-if=\"pagination\" class=\"flex items-center justify-center gap-2 mt-8\">\r\n        <button\r\n          v-if=\"pagination.current_page > 1\"\r\n          @click=\"fetchUpdates(pagination.current_page - 1)\"\r\n          class=\"px-3 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400\"\r\n        >\r\n          Previous\r\n        </button>\r\n\r\n        <span class=\"text-gray-600\">\r\n          Page {{ pagination.current_page }} of {{ pagination.last_page }}\r\n        </span>\r\n\r\n        <button\r\n          v-if=\"pagination.current_page < pagination.last_page\"\r\n          @click=\"fetchUpdates(pagination.current_page + 1)\"\r\n          class=\"px-3 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400\"\r\n        >\r\n          Next\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, inject, onMounted } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\n\r\nconst router = useRouter();\r\nconst residentAxios = inject('residentAxios');\r\n\r\nconst updates = ref([]);\r\nconst loading = ref(false);\r\nconst error = ref(null);\r\nconst syncing = ref(false);\r\nconst pagination = ref(null);\r\n\r\nconst fetchUpdates = async (page = 1) => {\r\n  loading.value = true;\r\n  error.value = null;\r\n\r\n  try {\r\n    console.log('[Disaster] Fetching updates, page:', page);\r\n    const response = await residentAxios.get('/disaster-updates', {\r\n      params: { page }\r\n    });\r\n\r\n    if (response.data && response.data.data) {\r\n      updates.value = response.data.data;\r\n      pagination.value = {\r\n        current_page: response.data.current_page,\r\n        last_page: response.data.last_page,\r\n        total: response.data.total,\r\n      };\r\n      console.log('[Disaster] Updates fetched:', updates.value.length);\r\n    }\r\n  } catch (err) {\r\n    console.error('[Disaster] Fetch error:', err);\r\n    error.value = 'Failed to load disaster updates. Please try again.';\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\nconst syncUpdates = async () => {\r\n  syncing.value = true;\r\n  error.value = null;\r\n\r\n  try {\r\n    console.log('[Disaster] Syncing updates from PAGASA/PhiVolcs/NDRRMC...');\r\n    const response = await residentAxios.post('/disaster-updates/sync');\r\n\r\n    if (response.data && response.data.success) {\r\n      alert(`‚úì Successfully synced ${response.data.synced_count} updates from PAGASA, PhiVolcs, and NDRRMC!\\n\\n${response.data.message}`);\r\n      await fetchUpdates(1);\r\n    } else {\r\n      alert('‚úó Error: ' + (response.data?.message || 'Unknown error'));\r\n    }\r\n  } catch (err) {\r\n    console.error('[Disaster] Sync error:', err);\r\n    error.value = 'Failed to sync updates. Please try again.';\r\n  } finally {\r\n    syncing.value = false;\r\n  }\r\n};\r\n\r\nconst goToDetail = (id) => {\r\n  console.log('[Disaster] Navigating to detail:', id);\r\n  router.push({ path: `/resident_pages/disaster-updates/${id}` });\r\n};\r\n\r\nconst formatDate = (dateString) => {\r\n  try {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  } catch (e) {\r\n    return dateString;\r\n  }\r\n};\r\n\r\nconst getTimeAgo = (dateString) => {\r\n  try {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const seconds = Math.floor((now - date) / 1000);\r\n\r\n    if (seconds < 60) return `${seconds}s ago`;\r\n    if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\r\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\r\n    if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;\r\n\r\n    return `${Math.floor(seconds / 604800)}w ago`;\r\n  } catch (e) {\r\n    return '';\r\n  }\r\n};\r\n\r\nonMounted(() => {\r\n  console.log('[Disaster] Component mounted');\r\n  fetchUpdates(1);\r\n});\r\n</script>\r\n"],"mappings":";AA2HA,SAASA,GAAG,EAAEC,MAAM,EAAEC,SAAS,QAAQ,KAAK;AAC5C,SAASC,SAAS,QAAQ,YAAY;;;;;;;IAEtC,MAAMC,MAAM,GAAGD,SAAS,CAAC,CAAC;IAC1B,MAAME,aAAa,GAAGJ,MAAM,CAAC,eAAe,CAAC;IAE7C,MAAMK,OAAO,GAAGN,GAAG,CAAC,EAAE,CAAC;IACvB,MAAMO,OAAO,GAAGP,GAAG,CAAC,KAAK,CAAC;IAC1B,MAAMQ,KAAK,GAAGR,GAAG,CAAC,IAAI,CAAC;IACvB,MAAMS,OAAO,GAAGT,GAAG,CAAC,KAAK,CAAC;IAC1B,MAAMU,UAAU,GAAGV,GAAG,CAAC,IAAI,CAAC;IAE5B,MAAMW,YAAY,GAAG,MAAAA,CAAOC,IAAI,GAAG,CAAC,KAAK;MACvCL,OAAO,CAACM,KAAK,GAAG,IAAI;MACpBL,KAAK,CAACK,KAAK,GAAG,IAAI;MAElB,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,oCAAoC,EAAEH,IAAI,CAAC;QACvD,MAAMI,QAAQ,GAAG,MAAMX,aAAa,CAACY,GAAG,CAAC,mBAAmB,EAAE;UAC5DC,MAAM,EAAE;YAAEN;UAAK;QACjB,CAAC,CAAC;QAEF,IAAII,QAAQ,CAACG,IAAI,IAAIH,QAAQ,CAACG,IAAI,CAACA,IAAI,EAAE;UACvCb,OAAO,CAACO,KAAK,GAAGG,QAAQ,CAACG,IAAI,CAACA,IAAI;UAClCT,UAAU,CAACG,KAAK,GAAG;YACjBO,YAAY,EAAEJ,QAAQ,CAACG,IAAI,CAACC,YAAY;YACxCC,SAAS,EAAEL,QAAQ,CAACG,IAAI,CAACE,SAAS;YAClCC,KAAK,EAAEN,QAAQ,CAACG,IAAI,CAACG;UACvB,CAAC;UACDR,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAET,OAAO,CAACO,KAAK,CAACU,MAAM,CAAC;QAClE;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZV,OAAO,CAACN,KAAK,CAAC,yBAAyB,EAAEgB,GAAG,CAAC;QAC7ChB,KAAK,CAACK,KAAK,GAAG,oDAAoD;MACpE,CAAC,SAAS;QACRN,OAAO,CAACM,KAAK,GAAG,KAAK;MACvB;IACF,CAAC;IAED,MAAMY,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9BhB,OAAO,CAACI,KAAK,GAAG,IAAI;MACpBL,KAAK,CAACK,KAAK,GAAG,IAAI;MAElB,IAAI;QACFC,OAAO,CAACC,GAAG,CAAC,2DAA2D,CAAC;QACxE,MAAMC,QAAQ,GAAG,MAAMX,aAAa,CAACqB,IAAI,CAAC,wBAAwB,CAAC;QAEnE,IAAIV,QAAQ,CAACG,IAAI,IAAIH,QAAQ,CAACG,IAAI,CAACQ,OAAO,EAAE;UAC1CC,KAAK,CAAC,yBAAyBZ,QAAQ,CAACG,IAAI,CAACU,YAAY,kDAAkDb,QAAQ,CAACG,IAAI,CAACW,OAAO,EAAE,CAAC;UACnI,MAAMnB,YAAY,CAAC,CAAC,CAAC;QACvB,CAAC,MAAM;UACLiB,KAAK,CAAC,WAAW,IAAIZ,QAAQ,CAACG,IAAI,EAAEW,OAAO,IAAI,eAAe,CAAC,CAAC;QAClE;MACF,CAAC,CAAC,OAAON,GAAG,EAAE;QACZV,OAAO,CAACN,KAAK,CAAC,wBAAwB,EAAEgB,GAAG,CAAC;QAC5ChB,KAAK,CAACK,KAAK,GAAG,2CAA2C;MAC3D,CAAC,SAAS;QACRJ,OAAO,CAACI,KAAK,GAAG,KAAK;MACvB;IACF,CAAC;IAED,MAAMkB,UAAU,GAAIC,EAAE,IAAK;MACzBlB,OAAO,CAACC,GAAG,CAAC,kCAAkC,EAAEiB,EAAE,CAAC;MACnD5B,MAAM,CAAC6B,IAAI,CAAC;QAAEC,IAAI,EAAE,oCAAoCF,EAAE;MAAG,CAAC,CAAC;IACjE,CAAC;IAED,MAAMG,UAAU,GAAIC,UAAU,IAAK;MACjC,IAAI;QACF,MAAMC,IAAI,GAAG,IAAIC,IAAI,CAACF,UAAU,CAAC;QACjC,OAAOC,IAAI,CAACE,kBAAkB,CAAC,OAAO,EAAE;UACtCC,IAAI,EAAE,SAAS;UACfC,KAAK,EAAE,OAAO;UACdC,GAAG,EAAE,SAAS;UACdC,IAAI,EAAE,SAAS;UACfC,MAAM,EAAE;QACV,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOC,CAAC,EAAE;QACV,OAAOT,UAAU;MACnB;IACF,CAAC;IAED,MAAMU,UAAU,GAAIV,UAAU,IAAK;MACjC,IAAI;QACF,MAAMC,IAAI,GAAG,IAAIC,IAAI,CAACF,UAAU,CAAC;QACjC,MAAMW,GAAG,GAAG,IAAIT,IAAI,CAAC,CAAC;QACtB,MAAMU,OAAO,GAAGC,IAAI,CAACC,KAAK,CAAC,CAACH,GAAG,GAAGV,IAAI,IAAI,IAAI,CAAC;QAE/C,IAAIW,OAAO,GAAG,EAAE,EAAE,OAAO,GAAGA,OAAO,OAAO;QAC1C,IAAIA,OAAO,GAAG,IAAI,EAAE,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACF,OAAO,GAAG,EAAE,CAAC,OAAO;QAC7D,IAAIA,OAAO,GAAG,KAAK,EAAE,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACF,OAAO,GAAG,IAAI,CAAC,OAAO;QAChE,IAAIA,OAAO,GAAG,MAAM,EAAE,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACF,OAAO,GAAG,KAAK,CAAC,OAAO;QAElE,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACF,OAAO,GAAG,MAAM,CAAC,OAAO;MAC/C,CAAC,CAAC,OAAOH,CAAC,EAAE;QACV,OAAO,EAAE;MACX;IACF,CAAC;IAED3C,SAAS,CAAC,MAAM;MACdY,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC;MAC3CJ,YAAY,CAAC,CAAC,CAAC;IACjB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}