{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, vShow as _vShow, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"space-y-6\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"py-8\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"text-red-700\"\n};\nconst _hoisted_4 = {\n  key: 2,\n  class: \"space-y-4\"\n};\nconst _hoisted_5 = {\n  class: \"text-2xl font-bold\"\n};\nconst _hoisted_6 = {\n  class: \"flex gap-4 items-center\"\n};\nconst _hoisted_7 = {\n  class: \"px-3 py-1 bg-gray-200 rounded\"\n};\nconst _hoisted_8 = {\n  class: \"text-gray-700\"\n};\nconst _hoisted_9 = {\n  key: 0,\n  class: \"rounded border\"\n};\nconst _hoisted_10 = {\n  class: \"p-3 bg-gray-50\"\n};\nconst _hoisted_11 = {\n  class: \"p-3\"\n};\nconst _hoisted_12 = {\n  key: 0,\n  class: \"text-red-700\"\n};\nconst _hoisted_13 = {\n  key: 1,\n  class: \"text-gray-600\"\n};\nconst _hoisted_14 = {\n  id: \"prediction-map\",\n  style: {\n    \"height\": \"360px\",\n    \"width\": \"100%\"\n  }\n};\nconst _hoisted_15 = {\n  class: \"bg-blue-50 p-3 rounded\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", {\n    class: \"flex items-center justify-between\"\n  }, [_createElementVNode(\"button\", {\n    onClick: $setup.goBack,\n    class: \"px-4 py-2 bg-gray-300 rounded\"\n  }, \"‚Üê Back\")]), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"Loading prediction...\")) : _createCommentVNode(\"v-if\", true), $setup.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString($setup.error), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), $setup.prediction ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"h1\", _hoisted_5, _toDisplayString($setup.prediction.location_name || 'Prediction Details'), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"span\", {\n    class: _normalizeClass([\"px-3 py-1 rounded font-semibold\", $setup.severityClass($setup.prediction.risk_level)])\n  }, \"Risk: \" + _toDisplayString($setup.prediction.risk_level) + \"/10\", 3 /* TEXT, CLASS */), _createElementVNode(\"span\", _hoisted_7, _toDisplayString($setup.prediction.disaster_type), 1 /* TEXT */)]), _createElementVNode(\"p\", _hoisted_8, _toDisplayString($setup.prediction.description || $setup.prediction.prediction_factors || ''), 1 /* TEXT */), $setup.prediction.latitude && $setup.prediction.longitude ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_createElementVNode(\"div\", _hoisted_10, \"üìç \" + _toDisplayString($setup.prediction.latitude) + \", \" + _toDisplayString($setup.prediction.longitude), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_11, [$setup.mapError ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, \"Map failed to load: \" + _toDisplayString($setup.mapError), 1 /* TEXT */)) : !$setup.mapReady ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"Loading map‚Ä¶\")) : _createCommentVNode(\"v-if\", true), _withDirectives(_createElementVNode(\"div\", _hoisted_14, null, 512 /* NEED_PATCH */), [[_vShow, $setup.mapReady]])])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_15, \"Predicted at: \" + _toDisplayString($setup.formatDate($setup.prediction.predicted_at)), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","id","style","_createElementBlock","_hoisted_1","_createElementVNode","onClick","$setup","goBack","loading","_hoisted_2","error","_hoisted_3","_toDisplayString","prediction","_hoisted_4","_hoisted_5","location_name","_hoisted_6","_normalizeClass","severityClass","risk_level","_hoisted_7","disaster_type","_hoisted_8","description","prediction_factors","latitude","longitude","_hoisted_9","_hoisted_10","_hoisted_11","mapError","_hoisted_12","mapReady","_hoisted_13","_hoisted_14","_hoisted_15","formatDate","predicted_at"],"sources":["C:\\VUEprojects\\crud-app\\src\\pages\\resident_pages\\DisasterPredictionDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"space-y-6\">\r\n    <div class=\"flex items-center justify-between\">\r\n      <button @click=\"goBack\" class=\"px-4 py-2 bg-gray-300 rounded\">‚Üê Back</button>\r\n    </div>\r\n\r\n    <div v-if=\"loading\" class=\"py-8\">Loading prediction...</div>\r\n    <div v-if=\"error\" class=\"text-red-700\">{{ error }}</div>\r\n\r\n    <div v-if=\"prediction\" class=\"space-y-4\">\r\n      <h1 class=\"text-2xl font-bold\">{{ prediction.location_name || 'Prediction Details' }}</h1>\r\n      <div class=\"flex gap-4 items-center\">\r\n        <span class=\"px-3 py-1 rounded font-semibold\" :class=\"severityClass(prediction.risk_level)\">Risk: {{ prediction.risk_level }}/10</span>\r\n        <span class=\"px-3 py-1 bg-gray-200 rounded\">{{ prediction.disaster_type }}</span>\r\n      </div>\r\n\r\n      <p class=\"text-gray-700\">{{ prediction.description || prediction.prediction_factors || '' }}</p>\r\n\r\n      <div v-if=\"prediction.latitude && prediction.longitude\" class=\"rounded border\">\r\n        <div class=\"p-3 bg-gray-50\">üìç {{ prediction.latitude }}, {{ prediction.longitude }}</div>\r\n        <div class=\"p-3\">\r\n          <div v-if=\"mapError\" class=\"text-red-700\">Map failed to load: {{ mapError }}</div>\r\n          <div v-else-if=\"!mapReady\" class=\"text-gray-600\">Loading map‚Ä¶</div>\r\n          <div id=\"prediction-map\" v-show=\"mapReady\" style=\"height: 360px; width: 100%;\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"bg-blue-50 p-3 rounded\">Predicted at: {{ formatDate(prediction.predicted_at) }}</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, inject, onMounted, onUnmounted, nextTick } from 'vue';\r\nimport { useRoute, useRouter } from 'vue-router';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst residentAxios = inject('residentAxios');\r\n\r\nconst prediction = ref(null);\r\nconst loading = ref(false);\r\nconst error = ref(null);\r\nconst mapReady = ref(false);\r\nconst mapError = ref(null);\r\nlet leafletMap = null;\r\n\r\nconst fetchPrediction = async (id) => {\r\n  loading.value = true;\r\n  error.value = null;\r\n  try {\r\n    const res = await residentAxios.get(`/disaster-predictions/${id}`);\r\n    if (res.data && res.data.data) prediction.value = res.data.data;\r\n    else prediction.value = res.data || null;\r\n\r\n    await nextTick();\r\n    if (prediction.value && prediction.value.latitude && prediction.value.longitude) {\r\n      initLeafletSafe(prediction.value.latitude, prediction.value.longitude);\r\n    }\r\n  } catch (e) {\r\n    console.error('[Pred] Fetch error', e);\r\n    error.value = 'Failed to load prediction';\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\nonMounted(() => {\r\n  const id = route.params.id;\r\n  if (id) fetchPrediction(id);\r\n});\r\n\r\nonUnmounted(() => {\r\n  try { if (leafletMap && leafletMap.remove) { leafletMap.remove(); leafletMap = null; } } catch(e) { console.warn(e); }\r\n});\r\n\r\nfunction goBack() { router.push({ path: '/resident_pages/disaster-predictions' }); }\r\n\r\nconst formatDate = (s) => s ? new Date(s).toLocaleString() : 'N/A';\r\nconst severityClass = (lvl) => {\r\n  if (lvl >= 8) return 'bg-red-600 text-white';\r\n  if (lvl >= 6) return 'bg-orange-600 text-white';\r\n  if (lvl >= 4) return 'bg-yellow-600 text-white';\r\n  return 'bg-green-600 text-white';\r\n};\r\n\r\n// Leaflet loader (CDN) and init\r\nfunction loadLeafletAssets(timeout = 10000) {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      if (window.L) return resolve(window.L);\r\n      const cssHref = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';\r\n      const jsSrc = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';\r\n      if (!document.querySelector(`link[href=\"${cssHref}\"]`)) {\r\n        const link = document.createElement('link'); link.rel = 'stylesheet'; link.href = cssHref; document.head.appendChild(link);\r\n      }\r\n      if (!document.querySelector(`script[src=\"${jsSrc}\"]`)) {\r\n        const script = document.createElement('script'); script.src = jsSrc; script.async = true;\r\n        script.onload = () => resolve(window.L);\r\n        script.onerror = () => reject(new Error('Failed to load Leaflet'));\r\n        document.head.appendChild(script);\r\n        setTimeout(() => { if (!window.L) reject(new Error('Leaflet load timed out')); }, timeout);\r\n      } else {\r\n        const t = setInterval(() => { if (window.L) { clearInterval(t); resolve(window.L); } }, 50);\r\n        setTimeout(() => { clearInterval(t); reject(new Error('Leaflet load timed out')); }, timeout);\r\n      }\r\n    } catch (e) { reject(e); }\r\n  });\r\n}\r\n\r\nfunction waitForElement(selector, timeout = 2000) {\r\n  return new Promise((resolve, reject) => {\r\n    const el = document.querySelector(selector); if (el) return resolve(el);\r\n    const interval = 50; let elapsed = 0; const t = setInterval(() => {\r\n      const found = document.querySelector(selector); elapsed += interval;\r\n      if (found) { clearInterval(t); return resolve(found); }\r\n      if (elapsed >= timeout) { clearInterval(t); return reject(new Error('Timed out waiting for ' + selector)); }\r\n    }, interval);\r\n  });\r\n}\r\n\r\nasync function initLeafletSafe(lat, lng) {\r\n  mapReady.value = false; mapError.value = null;\r\n  try {\r\n    const L = await loadLeafletAssets(10000);\r\n    const el = await waitForElement('#prediction-map', 5000);\r\n    if (!el) throw new Error('Map container not found');\r\n    leafletMap = L.map(el).setView([parseFloat(lat), parseFloat(lng)], 12);\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap contributors' }).addTo(leafletMap);\r\n    const marker = L.marker([parseFloat(lat), parseFloat(lng)]).addTo(leafletMap);\r\n    marker.bindPopup(`<strong>${prediction.value.location_name || 'Location'}</strong><br>${prediction.value.disaster_type || ''}`).openPopup();\r\n    mapReady.value = true;\r\n  } catch (e) {\r\n    console.error('[Pred] Map init error', e);\r\n    mapError.value = e.message || String(e);\r\n    mapReady.value = false;\r\n  }\r\n}\r\n</script>\r\n"],"mappings":";;EACOA,KAAK,EAAC;AAAW;;;EAKAA,KAAK,EAAC;;;;EACRA,KAAK,EAAC;;;;EAEDA,KAAK,EAAC;;;EACvBA,KAAK,EAAC;AAAoB;;EACzBA,KAAK,EAAC;AAAyB;;EAE5BA,KAAK,EAAC;AAA+B;;EAG1CA,KAAK,EAAC;AAAe;;;EAEgCA,KAAK,EAAC;;;EACvDA,KAAK,EAAC;AAAgB;;EACtBA,KAAK,EAAC;AAAK;;;EACOA,KAAK,EAAC;;;;EACAA,KAAK,EAAC;;;EAC5BC,EAAE,EAAC,gBAAgB;EAAmBC,KAAmC,EAAnC;IAAA;IAAA;EAAA;;;EAI1CF,KAAK,EAAC;AAAwB;;uBA1BvCG,mBAAA,CA4BM,OA5BNC,UA4BM,GA3BJC,mBAAA,CAEM;IAFDL,KAAK,EAAC;EAAmC,IAC5CK,mBAAA,CAA6E;IAApEC,OAAK,EAAEC,MAAA,CAAAC,MAAM;IAAER,KAAK,EAAC;KAAgC,QAAM,E,GAG3DO,MAAA,CAAAE,OAAO,I,cAAlBN,mBAAA,CAA4D,OAA5DO,UAA4D,EAA3B,uBAAqB,K,mCAC3CH,MAAA,CAAAI,KAAK,I,cAAhBR,mBAAA,CAAwD,OAAxDS,UAAwD,EAAAC,gBAAA,CAAdN,MAAA,CAAAI,KAAK,oB,mCAEpCJ,MAAA,CAAAO,UAAU,I,cAArBX,mBAAA,CAmBM,OAnBNY,UAmBM,GAlBJV,mBAAA,CAA0F,MAA1FW,UAA0F,EAAAH,gBAAA,CAAxDN,MAAA,CAAAO,UAAU,CAACG,aAAa,0CAC1DZ,mBAAA,CAGM,OAHNa,UAGM,GAFJb,mBAAA,CAAuI;IAAjIL,KAAK,EAAAmB,eAAA,EAAC,iCAAiC,EAASZ,MAAA,CAAAa,aAAa,CAACb,MAAA,CAAAO,UAAU,CAACO,UAAU;KAAG,QAAM,GAAAR,gBAAA,CAAGN,MAAA,CAAAO,UAAU,CAACO,UAAU,IAAG,KAAG,wBAChIhB,mBAAA,CAAiF,QAAjFiB,UAAiF,EAAAT,gBAAA,CAAlCN,MAAA,CAAAO,UAAU,CAACS,aAAa,iB,GAGzElB,mBAAA,CAAgG,KAAhGmB,UAAgG,EAAAX,gBAAA,CAApEN,MAAA,CAAAO,UAAU,CAACW,WAAW,IAAIlB,MAAA,CAAAO,UAAU,CAACY,kBAAkB,wBAExEnB,MAAA,CAAAO,UAAU,CAACa,QAAQ,IAAIpB,MAAA,CAAAO,UAAU,CAACc,SAAS,I,cAAtDzB,mBAAA,CAOM,OAPN0B,UAOM,GANJxB,mBAAA,CAA0F,OAA1FyB,WAA0F,EAA9D,KAAG,GAAAjB,gBAAA,CAAGN,MAAA,CAAAO,UAAU,CAACa,QAAQ,IAAG,IAAE,GAAAd,gBAAA,CAAGN,MAAA,CAAAO,UAAU,CAACc,SAAS,kBACjFvB,mBAAA,CAIM,OAJN0B,WAIM,GAHOxB,MAAA,CAAAyB,QAAQ,I,cAAnB7B,mBAAA,CAAkF,OAAlF8B,WAAkF,EAAxC,sBAAoB,GAAApB,gBAAA,CAAGN,MAAA,CAAAyB,QAAQ,oB,CACxDzB,MAAA,CAAA2B,QAAQ,I,cAAzB/B,mBAAA,CAAmE,OAAnEgC,WAAmE,EAAlB,cAAY,K,mDAC7D9B,mBAAA,CAAqF,OAArF+B,WAAqF,gC,SAApD7B,MAAA,CAAA2B,QAAQ,E,4CAI7C7B,mBAAA,CAAiG,OAAjGgC,WAAiG,EAA7D,gBAAc,GAAAxB,gBAAA,CAAGN,MAAA,CAAA+B,UAAU,CAAC/B,MAAA,CAAAO,UAAU,CAACyB,YAAY,kB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}