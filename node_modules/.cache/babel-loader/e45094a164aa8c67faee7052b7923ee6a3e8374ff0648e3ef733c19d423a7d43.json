{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { reactive, toRefs, onMounted } from 'vue';\nimport axios from 'axios';\nexport default {\n  __name: 'ReportEvacuation',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const state = reactive({\n      families: [],\n      evacuationAreas: [],\n      summary: {\n        total_families: 0,\n        total_evacuees: 0\n      },\n      filters: {\n        status: '',\n        evacuation_area_id: '',\n        date_from: '',\n        date_to: ''\n      },\n      loading: false,\n      error: null\n    });\n    function formatDate(dt) {\n      return dt ? new Date(dt).toLocaleString() : 'N/A';\n    }\n    async function fetchReport() {\n      state.loading = true;\n      state.error = null;\n      try {\n        const params = {\n          ...state.filters,\n          json: 1\n        };\n        const res = await axios.get('http://localhost:8000/api/reports/evacuation', {\n          params\n        });\n        state.families = res.data.data || [];\n        state.summary = res.data.summary || {\n          total_families: 0,\n          total_evacuees: 0\n        };\n      } catch (e) {\n        console.error(e);\n        state.error = e.message || 'Failed to load evacuation report.';\n      } finally {\n        state.loading = false;\n      }\n    }\n    async function loadAreas() {\n      try {\n        const res = await axios.get('http://localhost:8000/api/evacuation-areas');\n        state.evacuationAreas = res.data || [];\n      } catch (e) {\n        console.warn('Failed to load areas', e);\n      }\n    }\n    async function downloadCSV() {\n      const params = {\n        ...state.filters,\n        format: 'csv'\n      };\n      try {\n        const res = await axios.get('http://localhost:8000/api/reports/evacuation', {\n          params,\n          responseType: 'blob'\n        });\n        const blob = new Blob([res.data], {\n          type: 'text/csv'\n        });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `evacuation_report_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '_')}.csv`;\n        document.body.appendChild(a);\n        a.click();\n        a.remove();\n        window.URL.revokeObjectURL(url);\n      } catch (e) {\n        console.error('CSV download failed', e);\n        state.error = 'Failed to download CSV.';\n      }\n    }\n    onMounted(async () => {\n      await loadAreas();\n      await fetchReport();\n    });\n    const {\n      families,\n      evacuationAreas,\n      summary,\n      filters,\n      loading,\n      error\n    } = toRefs(state);\n    const __returned__ = {\n      state,\n      formatDate,\n      fetchReport,\n      loadAreas,\n      downloadCSV,\n      families,\n      evacuationAreas,\n      summary,\n      filters,\n      loading,\n      error,\n      reactive,\n      toRefs,\n      onMounted,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["reactive","toRefs","onMounted","axios","state","families","evacuationAreas","summary","total_families","total_evacuees","filters","status","evacuation_area_id","date_from","date_to","loading","error","formatDate","dt","Date","toLocaleString","fetchReport","params","json","res","get","data","e","console","message","loadAreas","warn","downloadCSV","format","responseType","blob","Blob","type","url","window","URL","createObjectURL","a","document","createElement","href","download","toISOString","slice","replace","body","appendChild","click","remove","revokeObjectURL"],"sources":["C:/VUEprojects/crud-app/src/pages/ReportEvacuation.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"header flex justify-between items-center mb-6\">\r\n      <h1 class=\"text-3xl font-bold gradient-text\">Evacuation Report</h1>\r\n    </div>\r\n\r\n```\r\n<!-- Filters -->\r\n<div class=\"card mb-6\">\r\n  <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n    <input v-model=\"filters.status\" placeholder=\"Status\" class=\"input-field\" />\r\n    <select v-model=\"filters.evacuation_area_id\" class=\"input-field\">\r\n      <option value=\"\">All Areas</option>\r\n      <option v-for=\"area in evacuationAreas\" :key=\"area.id\" :value=\"area.id\">{{ area.name }}</option>\r\n    </select>\r\n    <input type=\"date\" v-model=\"filters.date_from\" class=\"input-field\" />\r\n    <input type=\"date\" v-model=\"filters.date_to\" class=\"input-field\" />\r\n    <button @click=\"fetchReport\" class=\"btn-submit col-span-1 md:col-span-1\">Filter</button>\r\n  </div>\r\n</div>\r\n\r\n<!-- Summary -->\r\n<div class=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\r\n  <div class=\"info-box purple\">\r\n    <p class=\"label\">Total Families</p>\r\n    <p class=\"value\">{{ summary.total_families }}</p>\r\n  </div>\r\n  <div class=\"info-box green\">\r\n    <p class=\"label\">Total Evacuees</p>\r\n    <p class=\"value\">{{ summary.total_evacuees }}</p>\r\n  </div>\r\n</div>\r\n\r\n<!-- Table -->\r\n<div class=\"card\">\r\n  <table class=\"w-full table-auto border-collapse\">\r\n    <thead>\r\n      <tr>\r\n        <th class=\"th\">Family Head</th>\r\n        <th class=\"th\">Contact</th>\r\n        <th class=\"th\">Address</th>\r\n        <th class=\"th\">Members</th>\r\n        <th class=\"th\">Evacuation Area</th>\r\n        <th class=\"th\">Status</th>\r\n        <th class=\"th\">Evacuated At</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr v-for=\"family in families\" :key=\"family.id\">\r\n        <td class=\"td\">{{ family.family_head_name }}</td>\r\n        <td class=\"td\">{{ family.contact_number }}</td>\r\n        <td class=\"td\">{{ family.address }}</td>\r\n        <td class=\"td\">{{ family.total_members }}</td>\r\n        <td class=\"td\">{{ family.evacuationArea?.name || 'N/A' }}</td>\r\n        <td class=\"td\">{{ family.status }}</td>\r\n        <td class=\"td\">{{ formatDate(family.evacuated_at) }}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n```\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, toRefs, onMounted } from 'vue'\r\nimport axios from 'axios'\r\n\r\nconst state = reactive({\r\n  families: [],\r\n  evacuationAreas: [],\r\n  summary: { total_families: 0, total_evacuees: 0 },\r\n  filters: { status: '', evacuation_area_id: '', date_from: '', date_to: '' },\r\n  loading: false,\r\n  error: null,\r\n})\r\n\r\nfunction formatDate(dt) { return dt ? new Date(dt).toLocaleString() : 'N/A' }\r\n\r\nasync function fetchReport() {\r\n  state.loading = true\r\n  state.error = null\r\n  try {\r\n    const params = { ...state.filters, json: 1 }\r\n    const res = await axios.get('http://localhost:8000/api/reports/evacuation', { params })\r\n    state.families = res.data.data || []\r\n    state.summary = res.data.summary || { total_families: 0, total_evacuees: 0 }\r\n  } catch (e) {\r\n    console.error(e)\r\n    state.error = e.message || 'Failed to load evacuation report.'\r\n  } finally {\r\n    state.loading = false\r\n  }\r\n}\r\n\r\nasync function loadAreas() {\r\n  try {\r\n    const res = await axios.get('http://localhost:8000/api/evacuation-areas')\r\n    state.evacuationAreas = res.data || []\r\n  } catch (e) {\r\n    console.warn('Failed to load areas', e)\r\n  }\r\n}\r\n\r\nasync function downloadCSV() {\r\n  const params = { ...state.filters, format: 'csv' }\r\n  try {\r\n    const res = await axios.get('http://localhost:8000/api/reports/evacuation', { params, responseType: 'blob' })\r\n    const blob = new Blob([res.data], { type: 'text/csv' })\r\n    const url = window.URL.createObjectURL(blob)\r\n    const a = document.createElement('a')\r\n    a.href = url\r\n    a.download = `evacuation_report_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'_')}.csv`\r\n    document.body.appendChild(a)\r\n    a.click()\r\n    a.remove()\r\n    window.URL.revokeObjectURL(url)\r\n  } catch (e) {\r\n    console.error('CSV download failed', e)\r\n    state.error = 'Failed to download CSV.'\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await loadAreas()\r\n  await fetchReport()\r\n})\r\n\r\nconst { families, evacuationAreas, summary, filters, loading, error } = toRefs(state)\r\n</script>\r\n\r\n<style scoped>\r\n.container { max-width: 1100px; margin:0 auto; padding:20px; }\r\n.gradient-text { background: linear-gradient(90deg,#6366f1,#f43f5e); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }\r\n.card { background:#fff; border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:20px; }\r\n.input-field { border:1px solid #d1d5db; border-radius:8px; padding:8px; width:100%; }\r\n.btn-submit { background:#4f46e5; color:#fff; padding:8px 12px; border-radius:8px; }\r\n.info-box { padding:15px; border-radius:12px; }\r\n.info-box.purple { background:#f3e8ff; color:#7c3aed; }\r\n.info-box.green { background:#d1fae5; color:#059669; }\r\ntable { width:100%; border-collapse:collapse; }\r\n.th, .td { padding:8px; border:1px solid #e5e7eb; text-align:left; }\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}