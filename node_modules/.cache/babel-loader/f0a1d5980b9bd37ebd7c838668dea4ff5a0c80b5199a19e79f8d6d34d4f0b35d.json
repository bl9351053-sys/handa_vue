{"ast":null,"code":"import { ref, onMounted, onBeforeUnmount, inject } from 'vue';\nimport axios from 'axios';\nimport EmergencyAlerts from '../../components/resident_components/EmergencyAlerts.vue';\nexport default {\n  __name: 'ResidentDashboardPage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const loading = ref(true);\n    const error = ref(null);\n    const data = ref({});\n    const residentAxios = inject('residentAxios', null);\n    const injectedAdminBase = inject('baseUrl', null);\n    function formatDate(d) {\n      if (!d) return '';\n      try {\n        return new Date(d).toLocaleString();\n      } catch {\n        return d;\n      }\n    }\n    async function fetchDashboard() {\n      loading.value = true;\n      error.value = null;\n      try {\n        const http = residentAxios || axios;\n        const url = residentAxios ? '/dashboard' : (injectedAdminBase || 'http://127.0.0.1:8000/api') + '/dashboard';\n        const res = await http.get(url);\n        data.value = res.data || {};\n      } catch (e) {\n        error.value = e.message || 'Failed to fetch';\n      } finally {\n        loading.value = false;\n      }\n    }\n    function handleRefresh() {\n      fetchDashboard();\n    }\n    onMounted(() => {\n      fetchDashboard();\n      window.addEventListener('resident-dashboard-refresh', handleRefresh);\n    });\n    onBeforeUnmount(() => {\n      window.removeEventListener('resident-dashboard-refresh', handleRefresh);\n    });\n    const __returned__ = {\n      loading,\n      error,\n      data,\n      residentAxios,\n      injectedAdminBase,\n      formatDate,\n      fetchDashboard,\n      handleRefresh,\n      ref,\n      onMounted,\n      onBeforeUnmount,\n      inject,\n      get axios() {\n        return axios;\n      },\n      EmergencyAlerts\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onBeforeUnmount","inject","axios","EmergencyAlerts","loading","error","data","residentAxios","injectedAdminBase","formatDate","d","Date","toLocaleString","fetchDashboard","value","http","url","res","get","e","message","handleRefresh","window","addEventListener","removeEventListener"],"sources":["C:/VUEprojects/crud-app/src/pages/resident_pages/ResidentDashboardPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"resident-dashboard\">\r\n    <header class=\"header\">\r\n      <h1>Dashboard</h1>\r\n      <p class=\"subtitle\">Overview for residents ‚Äî live data from the System‚ÄëE API</p>\r\n    </header>\r\n\r\n    <!-- Emergency Alerts Section -->\r\n    <EmergencyAlerts />\r\n\r\n    <div v-if=\"loading\" class=\"center\">Loading dashboard‚Ä¶</div>\r\n<div v-else-if=\"error\" class=\"center error\">Error: {{ error }}</div>\r\n\r\n<div v-else>\r\n  <!-- Overview Stats -->\r\n  <div class=\"card overview-card\">\r\n    <div class=\"card-header\">üìä Dashboard Overview</div>\r\n    <div class=\"stats-grid\">\r\n      <div class=\"stat-card\">\r\n        <div class=\"stat-icon\">üè¢</div>\r\n        <div class=\"stat-info\">\r\n          <h3>{{ data.totalEvacuationAreas ?? 0 }}</h3>\r\n          <p>Total Evacuation Areas</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"stat-card\">\r\n        <div class=\"stat-icon\">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>\r\n        <div class=\"stat-info\">\r\n          <h3>{{ data.totalFamilies ?? 0 }}</h3>\r\n          <p>Families Evacuated</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"stat-card\">\r\n        <div class=\"stat-icon\">üë•</div>\r\n        <div class=\"stat-info\">\r\n          <h3>{{ data.totalPeople ?? 0 }}</h3>\r\n          <p>Total People</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"stat-card\">\r\n        <div class=\"stat-icon\">‚úÖ</div>\r\n        <div class=\"stat-info\">\r\n          <h3>{{ data.availableAreas ?? 0 }}</h3>\r\n          <p>Available Areas</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"stat-card\">\r\n        <div class=\"stat-icon\">üö´</div>\r\n        <div class=\"stat-info\">\r\n          <h3>{{ data.fullAreas ?? 0 }}</h3>\r\n          <p>Full Areas</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Two Columns: Recent Updates & Active Predictions -->\r\n  <section class=\"two-col\">\r\n    <div class=\"card\">\r\n      <div class=\"card-header\">üö® Recent Disaster Updates</div>\r\n      <div v-if=\"(data.recentUpdates || []).length === 0\" class=\"muted\">No recent disaster updates.</div>\r\n      <ul v-else class=\"list\">\r\n        <li v-for=\"update in (data.recentUpdates || []).slice(0, 3)\" :key=\"update.id\">\r\n          <strong>{{ update.disaster_type ?? 'Update' }}</strong>\r\n          <div class=\"muted\">{{ formatDate(update.issued_at) }} ‚Äî {{ update.summary ?? (update.description ?? '') }}</div>\r\n        </li>\r\n      </ul>\r\n      <router-link :to=\"{ name: 'ResidentDisasterUpdates' }\" class=\"btn btn-primary full-width\">View All Updates</router-link>\r\n    </div>\r\n\r\n    <div class=\"card\">\r\n      <div class=\"card-header\">üîÆ Active Predictions</div>\r\n      <div v-if=\"(data.activePredictions || []).length === 0\" class=\"muted\">No active predictions.</div>\r\n      <ul v-else class=\"list\">\r\n        <li v-for=\"pred in (data.activePredictions || []).slice(0, 3)\" :key=\"pred.id\">\r\n          <strong>{{ pred.disaster_type ?? 'Prediction' }} ‚Äî Risk {{ pred.risk_level ?? '-' }}</strong>\r\n          <div class=\"muted\">Issued: {{ formatDate(pred.issued_at ?? pred.created_at) }}</div>\r\n        </li>\r\n      </ul>\r\n      <router-link :to=\"{ name: 'ResidentDisasterPredictions' }\" class=\"btn btn-primary full-width\">View All Predictions</router-link>\r\n    </div>\r\n  </section>\r\n</div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onBeforeUnmount, inject } from 'vue';\r\nimport axios from 'axios';\r\nimport EmergencyAlerts from '../../components/resident_components/EmergencyAlerts.vue';\r\n\r\nconst loading = ref(true);\r\nconst error = ref(null);\r\nconst data = ref({});\r\n\r\nconst residentAxios = inject('residentAxios', null);\r\nconst injectedAdminBase = inject('baseUrl', null);\r\n\r\nfunction formatDate(d) {\r\n  if (!d) return '';\r\n  try { return new Date(d).toLocaleString(); } \r\n  catch { return d; }\r\n}\r\n\r\nasync function fetchDashboard() {\r\n  loading.value = true;\r\n  error.value = null;\r\n  try {\r\n    const http = residentAxios || axios;\r\n    const url = residentAxios ? '/dashboard' : (injectedAdminBase || 'http://127.0.0.1:8000/api') + '/dashboard';\r\n    const res = await http.get(url);\r\n    data.value = res.data || {};\r\n  } catch (e) { error.value = e.message || 'Failed to fetch'; }\r\n  finally { loading.value = false; }\r\n}\r\n\r\nfunction handleRefresh() { fetchDashboard(); }\r\n\r\nonMounted(() => {\r\n  fetchDashboard();\r\n  window.addEventListener('resident-dashboard-refresh', handleRefresh);\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n  window.removeEventListener('resident-dashboard-refresh', handleRefresh);\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n/* Container */\r\n.resident-dashboard {\r\n  padding: 2rem;\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n  color: #333;\r\n}\r\n.header h1 { margin: 0 0 0.25rem 0; font-size: 2rem; }\r\n.subtitle { color: #666; margin-bottom: 1.5rem; }\r\n.center { text-align: center; padding: 2rem 0; font-size: 1.1rem; }\r\n.error { color: #b00020; }\r\n\r\n/* Card */\r\n.card {\r\n  background: #fff;\r\n  border-radius: 12px;\r\n  padding: 20px;\r\n  box-shadow: 0 6px 20px rgba(0,0,0,0.08);\r\n  margin-bottom: 1.5rem;\r\n  transition: transform 0.2s, box-shadow 0.2s;\r\n}\r\n.card:hover {\r\n  transform: translateY(-3px);\r\n  box-shadow: 0 10px 25px rgba(0,0,0,0.12);\r\n}\r\n.card-header {\r\n  font-weight: 600;\r\n  margin-bottom: 15px;\r\n  font-size: 1.1rem;\r\n}\r\n\r\n/* Stats Grid */\r\n.stats-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(160px,1fr));\r\n  gap: 1rem;\r\n}\r\n.stat-card {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  padding: 18px 12px;\r\n  border-radius: 12px;\r\n  background: linear-gradient(135deg,#f5f7fa,#e0eafc);\r\n  text-align: center;\r\n  box-shadow: 0 2px 8px rgba(0,0,0,0.05);\r\n  transition: transform 0.2s;\r\n}\r\n.stat-card:hover { transform: translateY(-3px); }\r\n.stat-icon { font-size: 2rem; margin-bottom: 8px; }\r\n.stat-info h3 { margin: 0; font-size: 1.5rem; font-weight: 700; }\r\n.stat-info p { margin: 4px 0 0 0; font-size: 0.9rem; color: #555; }\r\n\r\n/* Two Column Section */\r\n.two-col {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 1.5rem;\r\n}\r\n@media(max-width: 900px) { .two-col { grid-template-columns: 1fr; } }\r\n\r\n/* List Styling */\r\n.list { list-style: none; padding: 0; margin: 0; }\r\n.list li { padding: 0.6rem 0; border-bottom: 1px solid #eee; }\r\n.muted { color: #666; font-size: 0.875rem; margin-top: 2px; }\r\n\r\n/* Buttons */\r\n.btn { display: inline-block; padding: 10px 18px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 500; transition: background 0.3s; }\r\n.btn-primary { background-color: #007bff; color: #fff; }\r\n.btn-primary:hover { background-color: #0069d9; }\r\n.full-width { width: 100%; margin-top: 12px; }\r\n\r\n/* Responsive */\r\n@media(max-width: 500px){\r\n  .stat-card { padding: 16px 10px; }\r\n  .stat-info h3 { font-size: 1.25rem; }\r\n}\r\n</style>\r\n"],"mappings":"AAwFA,SAASA,GAAG,EAAEC,SAAS,EAAEC,eAAe,EAAEC,MAAM,QAAQ,KAAK;AAC7D,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,eAAe,MAAM,0DAA0D;;;;;;;IAEtF,MAAMC,OAAO,GAAGN,GAAG,CAAC,IAAI,CAAC;IACzB,MAAMO,KAAK,GAAGP,GAAG,CAAC,IAAI,CAAC;IACvB,MAAMQ,IAAI,GAAGR,GAAG,CAAC,CAAC,CAAC,CAAC;IAEpB,MAAMS,aAAa,GAAGN,MAAM,CAAC,eAAe,EAAE,IAAI,CAAC;IACnD,MAAMO,iBAAiB,GAAGP,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC;IAEjD,SAASQ,UAAUA,CAACC,CAAC,EAAE;MACrB,IAAI,CAACA,CAAC,EAAE,OAAO,EAAE;MACjB,IAAI;QAAE,OAAO,IAAIC,IAAI,CAACD,CAAC,CAAC,CAACE,cAAc,CAAC,CAAC;MAAE,CAAC,CAC5C,MAAM;QAAE,OAAOF,CAAC;MAAE;IACpB;IAEA,eAAeG,cAAcA,CAAA,EAAG;MAC9BT,OAAO,CAACU,KAAK,GAAG,IAAI;MACpBT,KAAK,CAACS,KAAK,GAAG,IAAI;MAClB,IAAI;QACF,MAAMC,IAAI,GAAGR,aAAa,IAAIL,KAAK;QACnC,MAAMc,GAAG,GAAGT,aAAa,GAAG,YAAY,GAAG,CAACC,iBAAiB,IAAI,2BAA2B,IAAI,YAAY;QAC5G,MAAMS,GAAG,GAAG,MAAMF,IAAI,CAACG,GAAG,CAACF,GAAG,CAAC;QAC/BV,IAAI,CAACQ,KAAK,GAAGG,GAAG,CAACX,IAAI,IAAI,CAAC,CAAC;MAC7B,CAAC,CAAC,OAAOa,CAAC,EAAE;QAAEd,KAAK,CAACS,KAAK,GAAGK,CAAC,CAACC,OAAO,IAAI,iBAAiB;MAAE,CAAC,SACrD;QAAEhB,OAAO,CAACU,KAAK,GAAG,KAAK;MAAE;IACnC;IAEA,SAASO,aAAaA,CAAA,EAAG;MAAER,cAAc,CAAC,CAAC;IAAE;IAE7Cd,SAAS,CAAC,MAAM;MACdc,cAAc,CAAC,CAAC;MAChBS,MAAM,CAACC,gBAAgB,CAAC,4BAA4B,EAAEF,aAAa,CAAC;IACtE,CAAC,CAAC;IAEFrB,eAAe,CAAC,MAAM;MACpBsB,MAAM,CAACE,mBAAmB,CAAC,4BAA4B,EAAEH,aAAa,CAAC;IACzE,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}