{"ast":null,"code":"import { ref, onMounted, onBeforeUnmount, inject } from 'vue';\nimport axios from 'axios';\nexport default {\n  __name: 'ResidentDashboardPage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const loading = ref(true);\n    const error = ref(null);\n    const data = ref({});\n\n    // Inject residentAxios provided by main.js. Fall back to global axios if missing.\n    const residentAxios = inject('residentAxios', null);\n    // also inject admin base for debugging visibility\n    const injectedAdminBase = inject('baseUrl', null);\n    function formatDate(d) {\n      if (!d) return '';\n      try {\n        const dt = new Date(d);\n        return dt.toLocaleString();\n      } catch (e) {\n        return d;\n      }\n    }\n    async function fetchDashboard() {\n      loading.value = true;\n      error.value = null;\n      lastRequestUrl.value = '';\n      lastResponseStatus.value = null;\n      try {\n        // Prefer residentAxios if available (it will already have baseURL configured)\n        if (residentAxios) {\n          try {\n            const candidate = '/dashboard'; // relative to residentAxios.baseURL\n            lastRequestUrl.value = residentAxios.defaults.baseURL + candidate;\n            console.log('[ResidentDashboard] requesting (residentAxios)', lastRequestUrl.value);\n            const res = await residentAxios.get(candidate);\n            lastResponseStatus.value = res.status;\n            console.log('[ResidentDashboard] response', res.status, res.data);\n            data.value = res.data || {};\n            return;\n          } catch (err) {\n            console.warn('[ResidentDashboard] residentAxios request failed', err && err.message ? err.message : err);\n            // fall through to try global axios candidates\n          }\n        }\n\n        // Fallback: try a few candidates using global axios (which is configured for admin API)\n        const adminBase = injectedAdminBase || process.env.VUE_APP_ADMIN_API_URL || 'http://127.0.0.1:8000/api';\n        const baseNoSlash = adminBase.replace(/\\/$/, '');\n        const candidates = [`${baseNoSlash}/dashboard`, `${baseNoSlash}/api/dashboard`, `/api/dashboard`, `/dashboard`];\n        let lastErr = null;\n        for (const candidate of candidates) {\n          try {\n            lastRequestUrl.value = candidate;\n            console.log('[ResidentDashboard] requesting', candidate);\n            const res = await axios.get(candidate, {\n              headers: {\n                Accept: 'application/json'\n              }\n            });\n            lastResponseStatus.value = res.status;\n            console.log('[ResidentDashboard] response', res.status, res.data);\n            data.value = res.data || {};\n            lastErr = null;\n            break; // success\n          } catch (err) {\n            console.warn('[ResidentDashboard] request failed for', candidate, err && err.message ? err.message : err);\n            lastErr = err;\n          }\n        }\n        if (lastErr) throw lastErr;\n      } catch (e) {\n        console.error('Failed to fetch dashboard', e);\n        error.value = e.message || String(e);\n      } finally {\n        loading.value = false;\n      }\n    }\n\n    // Debug refs\n    const lastRequestUrl = ref('');\n    const lastResponseStatus = ref(null);\n    function handleRefresh() {\n      fetchDashboard();\n    }\n    onMounted(() => {\n      fetchDashboard();\n      window.addEventListener('resident-dashboard-refresh', handleRefresh);\n    });\n    onBeforeUnmount(() => {\n      window.removeEventListener('resident-dashboard-refresh', handleRefresh);\n    });\n    const __returned__ = {\n      loading,\n      error,\n      data,\n      residentAxios,\n      injectedAdminBase,\n      formatDate,\n      fetchDashboard,\n      lastRequestUrl,\n      lastResponseStatus,\n      handleRefresh,\n      ref,\n      onMounted,\n      onBeforeUnmount,\n      inject,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onBeforeUnmount","inject","axios","loading","error","data","residentAxios","injectedAdminBase","formatDate","d","dt","Date","toLocaleString","e","fetchDashboard","value","lastRequestUrl","lastResponseStatus","candidate","defaults","baseURL","console","log","res","get","status","err","warn","message","adminBase","process","env","VUE_APP_ADMIN_API_URL","baseNoSlash","replace","candidates","lastErr","headers","Accept","String","handleRefresh","window","addEventListener","removeEventListener"],"sources":["C:/VUEprojects/crud-app/src/pages/resident_pages/ResidentDashboardPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"resident-dashboard\">\r\n    <header class=\"header\">\r\n      <h1>Dashboard</h1>\r\n      <p class=\"subtitle\">Overview for residents ‚Äî live data from the System‚ÄëE API</p>\r\n    </header>\r\n\r\n    <div v-if=\"loading\" class=\"center\">Loading dashboard‚Ä¶</div>\r\n    <div v-else-if=\"error\" class=\"center error\">Error: {{ error }}</div>\r\n\r\n    <div v-else>\r\n      <div class=\"card\">\r\n        <div class=\"card-header\">üìä Dashboard Overview</div>\r\n        \r\n        <div class=\"stats-grid\">\r\n          <div class=\"stat-card\">\r\n            <div class=\"stat-icon\">üè¢</div>\r\n            <div class=\"stat-info\">\r\n              <h3>{{ data.totalEvacuationAreas ?? 0 }}</h3>\r\n              <p>Total Evacuation Areas</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"stat-card\">\r\n            <div class=\"stat-icon\">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>\r\n            <div class=\"stat-info\">\r\n              <h3>{{ data.totalFamilies ?? 0 }}</h3>\r\n              <p>Families Evacuated</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"stat-card\">\r\n            <div class=\"stat-icon\">üë•</div>\r\n            <div class=\"stat-info\">\r\n              <h3>{{ data.totalPeople ?? 0 }}</h3>\r\n              <p>Total People</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"stat-card\">\r\n            <div class=\"stat-icon\">‚úÖ</div>\r\n            <div class=\"stat-info\">\r\n              <h3>{{ data.availableAreas ?? 0 }}</h3>\r\n              <p>Available Areas</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"stat-card\">\r\n            <div class=\"stat-icon\">üö´</div>\r\n            <div class=\"stat-info\">\r\n              <h3>{{ data.fullAreas ?? 0 }}</h3>\r\n              <p>Full Areas</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <section class=\"two-col\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">üö® Recent Disaster Updates</div>\r\n          <div v-if=\"(data.recentUpdates || []).length === 0\" class=\"muted\">No recent disaster updates.</div>\r\n          <ul v-else class=\"list\">\r\n            <li v-for=\"update in data.recentUpdates\" :key=\"update.id\">\r\n              <strong>{{ update.disaster_type ?? 'Update' }}</strong>\r\n              <div class=\"muted\">{{ formatDate(update.issued_at) }} ‚Äî {{ update.summary ?? (update.description ?? '') }}</div>\r\n            </li>\r\n          </ul>\r\n          <div style=\"margin-top:8px\"><router-link to=\"/disaster-updates\" class=\"btn btn-primary w-100\">View All Updates</router-link></div>\r\n        </div>\r\n\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">üîÆ Active Predictions</div>\r\n          <div v-if=\"(data.activePredictions || []).length === 0\" class=\"muted\">No active predictions.</div>\r\n          <ul v-else class=\"list\">\r\n            <li v-for=\"pred in data.activePredictions\" :key=\"pred.id\">\r\n              <strong>{{ pred.disaster_type ?? 'Prediction' }} ‚Äî Risk {{ pred.risk_level ?? '-' }}</strong>\r\n              <div class=\"muted\">Issued: {{ formatDate(pred.issued_at ?? pred.created_at) }}</div>\r\n            </li>\r\n          </ul>\r\n          <div style=\"margin-top:8px\"><router-link to=\"/disaster-predictions\" class=\"btn btn-primary w-100\">View All Predictions</router-link></div>\r\n        </div>\r\n      </section>\r\n\r\n      <section class=\"card\">\r\n        <div class=\"card-header\">üè¢ Evacuation Areas</div>\r\n        <div v-if=\"(data.evacuationAreas || []).length === 0\" class=\"muted\">No evacuation areas available.</div>\r\n        <table v-else class=\"areas-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Name</th>\r\n              <th>Capacity</th>\r\n              <th>Occupancy</th>\r\n              <th>Status</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"area in data.evacuationAreas\" :key=\"area.id\">\r\n              <td>{{ area.name }}</td>\r\n              <td>{{ area.capacity ?? '‚Äî' }}</td>\r\n              <td>{{ area.current_occupancy ?? area.current_occupants ?? 0 }}</td>\r\n              <td>{{ area.status ?? 'unknown' }}</td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </section>\r\n\r\n      \r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onBeforeUnmount, inject } from 'vue';\r\nimport axios from 'axios';\r\n\r\nconst loading = ref(true);\r\nconst error = ref(null);\r\nconst data = ref({});\r\n\r\n// Inject residentAxios provided by main.js. Fall back to global axios if missing.\r\nconst residentAxios = inject('residentAxios', null);\r\n// also inject admin base for debugging visibility\r\nconst injectedAdminBase = inject('baseUrl', null);\r\n\r\nfunction formatDate(d) {\r\n  if (!d) return '';\r\n  try {\r\n    const dt = new Date(d);\r\n    return dt.toLocaleString();\r\n  } catch (e) {\r\n    return d;\r\n  }\r\n}\r\n\r\nasync function fetchDashboard() {\r\n  loading.value = true;\r\n  error.value = null;\r\n  lastRequestUrl.value = '';\r\n  lastResponseStatus.value = null;\r\n  try {\r\n    // Prefer residentAxios if available (it will already have baseURL configured)\r\n    if (residentAxios) {\r\n      try {\r\n        const candidate = '/dashboard'; // relative to residentAxios.baseURL\r\n        lastRequestUrl.value = residentAxios.defaults.baseURL + candidate;\r\n        console.log('[ResidentDashboard] requesting (residentAxios)', lastRequestUrl.value);\r\n        const res = await residentAxios.get(candidate);\r\n        lastResponseStatus.value = res.status;\r\n        console.log('[ResidentDashboard] response', res.status, res.data);\r\n        data.value = res.data || {};\r\n        return;\r\n      } catch (err) {\r\n        console.warn('[ResidentDashboard] residentAxios request failed', err && err.message ? err.message : err);\r\n        // fall through to try global axios candidates\r\n      }\r\n    }\r\n\r\n    // Fallback: try a few candidates using global axios (which is configured for admin API)\r\n    const adminBase = injectedAdminBase || (process.env.VUE_APP_ADMIN_API_URL || 'http://127.0.0.1:8000/api');\r\n    const baseNoSlash = adminBase.replace(/\\/$/, '');\r\n    const candidates = [`${baseNoSlash}/dashboard`, `${baseNoSlash}/api/dashboard`, `/api/dashboard`, `/dashboard`];\r\n\r\n    let lastErr = null;\r\n    for (const candidate of candidates) {\r\n      try {\r\n        lastRequestUrl.value = candidate;\r\n        console.log('[ResidentDashboard] requesting', candidate);\r\n        const res = await axios.get(candidate, { headers: { Accept: 'application/json' } });\r\n        lastResponseStatus.value = res.status;\r\n        console.log('[ResidentDashboard] response', res.status, res.data);\r\n        data.value = res.data || {};\r\n        lastErr = null;\r\n        break; // success\r\n      } catch (err) {\r\n        console.warn('[ResidentDashboard] request failed for', candidate, err && err.message ? err.message : err);\r\n        lastErr = err;\r\n      }\r\n    }\r\n\r\n    if (lastErr) throw lastErr;\r\n  } catch (e) {\r\n    console.error('Failed to fetch dashboard', e);\r\n    error.value = e.message || String(e);\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n}\r\n\r\n// Debug refs\r\nconst lastRequestUrl = ref('');\r\nconst lastResponseStatus = ref(null);\r\n\r\nfunction handleRefresh() { fetchDashboard(); }\r\n\r\nonMounted(() => {\r\n  fetchDashboard();\r\n  window.addEventListener('resident-dashboard-refresh', handleRefresh);\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n  window.removeEventListener('resident-dashboard-refresh', handleRefresh);\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.resident-dashboard { padding: 1rem; max-width: 1100px; margin: 0 auto; }\r\n.header h1 { margin: 0 0 0.25rem 0; }\r\n.subtitle { color: #666; margin-bottom: 1rem; }\r\n.center { text-align: center; padding: 1.5rem; }\r\n.error { color: #b00020; }\r\n.stats-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); gap: 1rem; margin-bottom: 1rem; }\r\n.stat-card { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); text-align: center; }\r\n.stat-value { font-size: 1.6rem; font-weight: 700; }\r\n.stat-label { color: #666; font-size: 0.9rem; }\r\n.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }\r\n.card { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }\r\n.muted { color: #666; font-size: 0.9rem; }\r\n.list { list-style: none; padding: 0; margin: 0; }\r\n.list li { padding: 0.5rem 0; border-bottom: 1px solid #f0f0f0; }\r\n.areas-table { width: 100%; border-collapse: collapse; }\r\n.areas-table th, .areas-table td { text-align: left; padding: 0.5rem; border-bottom: 1px solid #eee; }\r\n@media (max-width: 800px) { .two-col { grid-template-columns: 1fr; } }\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}